<!DOCTYPE html>
<html>
<head>
  <title>7TV API Test</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #0f0; }
    button { padding: 10px; margin: 5px; cursor: pointer; }
    #output { margin-top: 20px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>7TV API Test</h1>
  <button onclick="testGlobal()">Test Global Emotes</button>
  <button onclick="testSearch()">Test Search (pepe)</button>
  <div id="output"></div>

  <script>
    const output = document.getElementById('output');
    
    async function testGlobal() {
      output.textContent = 'Fetching global emotes...\n';
      try {
        const response = await fetch('https://7tv.io/v3/emote-sets/global');
        const data = await response.json();
        output.textContent += `Status: ${response.status}\n`;
        output.textContent += `Emotes count: ${data.emotes?.length || 0}\n`;
        output.textContent += `\nFirst emote structure:\n`;
        output.textContent += `ID: ${data.emotes?.[0]?.data?.id}\n`;
        output.textContent += `Name: ${data.emotes?.[0]?.data?.name}\n`;
        output.textContent += `Animated: ${data.emotes?.[0]?.data?.animated}\n`;
        output.textContent += `\nSearching locally for "pepe"...\n`;
        const pepeEmotes = data.emotes.filter(e => 
          e.data.name.toLowerCase().includes('pepe')
        );
        output.textContent += `Found ${pepeEmotes.length} pepe emotes\n`;
        if (pepeEmotes.length > 0) {
          output.textContent += `Examples: ${pepeEmotes.slice(0, 5).map(e => e.data.name).join(', ')}`;
        }
      } catch (error) {
        output.textContent += `ERROR: ${error.message}`;
      }
    }
    
    async function testSearch() {
      output.textContent = 'Testing 7TV GraphQL search...\n';
      try {
        const query = 'pepe';
        const gqlQuery = `
          query SearchEmotes($query: String!, $limit: Int) {
            emotes(query: $query, limit: $limit) {
              count
              items {
                id
                name
                animated
              }
            }
          }
        `;
        
        const response = await fetch('https://7tv.io/v3/gql', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            query: gqlQuery,
            variables: { query, limit: 50 }
          })
        });
        
        output.textContent += `Status: ${response.status}\n`;
        
        const data = await response.json();
        output.textContent += `Response: ${JSON.stringify(data, null, 2)}\n\n`;
        
        if (data.data?.emotes?.items) {
          output.textContent += `Found ${data.data.emotes.count} total, showing ${data.data.emotes.items.length}:\n\n`;
          data.data.emotes.items.slice(0, 10).forEach(e => {
            output.textContent += `- ${e.name} (${e.animated ? 'animated' : 'static'})\n`;
          });
        } else {
          output.textContent += 'NO RESULTS\n';
        }
      } catch (error) {
        output.textContent += `ERROR: ${error.message}`;
      }
    }
  </script>
</body>
</html>
