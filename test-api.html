<!DOCTYPE html>
<html>
<head>
  <title>7TV API Test</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #0f0; }
    button { padding: 10px; margin: 5px; cursor: pointer; }
    #output { margin-top: 20px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>7TV API Test</h1>
  <button onclick="testGlobal()">Test Global Emotes</button>
  <button onclick="testSearch()">Test Search (pepe)</button>
  <div id="output"></div>

  <script>
    const output = document.getElementById('output');
    
    async function testGlobal() {
      output.textContent = 'Fetching global emotes...\n';
      try {
        const response = await fetch('https://7tv.io/v3/emote-sets/global');
        const data = await response.json();
        output.textContent += `Status: ${response.status}\n`;
        output.textContent += `Emotes count: ${data.emotes?.length || 0}\n`;
        output.textContent += `\nFirst emote structure:\n`;
        output.textContent += `ID: ${data.emotes?.[0]?.data?.id}\n`;
        output.textContent += `Name: ${data.emotes?.[0]?.data?.name}\n`;
        output.textContent += `Animated: ${data.emotes?.[0]?.data?.animated}\n`;
        output.textContent += `\nSearching locally for "pepe"...\n`;
        const pepeEmotes = data.emotes.filter(e => 
          e.data.name.toLowerCase().includes('pepe')
        );
        output.textContent += `Found ${pepeEmotes.length} pepe emotes\n`;
        if (pepeEmotes.length > 0) {
          output.textContent += `Examples: ${pepeEmotes.slice(0, 5).map(e => e.data.name).join(', ')}`;
        }
      } catch (error) {
        output.textContent += `ERROR: ${error.message}`;
      }
    }
    
    async function testSearch() {
      output.textContent = 'Testing 7TV GraphQL filters...\n';
      try {
        const gqlQuery = `
          query TestFilters {
            emotes(query: "pepe", limit: 5) {
              items {
                id
                name
                animated
                flags
                lifecycle
                state
                listed
                tags
              }
            }
          }
        `;
        
        const response = await fetch('https://7tv.io/v3/gql', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query: gqlQuery })
        });
        
        const data = await response.json();
        output.textContent += `Full emote data:\n${JSON.stringify(data, null, 2)}\n\n`;
        
        if (data.data?.emotes?.items) {
          output.textContent += `Sample emotes with all fields:\n\n`;
          data.data.emotes.items.forEach(e => {
            output.textContent += `${e.name}:\n`;
            output.textContent += `  Animated: ${e.animated}\n`;
            output.textContent += `  Flags: ${e.flags}\n`;
            output.textContent += `  Listed: ${e.listed}\n`;
            output.textContent += `  State: ${JSON.stringify(e.state)}\n`;
            output.textContent += `  Tags: ${JSON.stringify(e.tags)}\n\n`;
          });
        }
      } catch (error) {
        output.textContent += `ERROR: ${error.message}`;
      }
    }
  </script>
</body>
</html>
